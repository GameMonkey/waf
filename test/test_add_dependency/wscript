#! /usr/bin/env python
# encoding: utf-8

APPNAME = 'test_add_dependency'
VERSION = '1.0.0'

import mock
import os
import shutil

import wurf_determine_git_directory

def resolve(ctx):

    # Replace git clone
    ctx.git_clone = mock.Mock()
    #ctx.
    return

    def fake_git_clone(ctx, source, destination):
        """ Mocking the resolve function which is the one called when
        fetching a dependency"""
        libfoo = wurf_determine_git_directory(
            name='links',
            checkout='master',
            source='https://gitlab.com/steinwurf/links.git')

        # The source directory is create by the test directory
        src_dir libfoo+'-clone'

        return p

    resolver = mock.Mock()
    resolver.resolve.side_effect = mock_resolve
    resolver.hash.return_value = 'h4sh'

    ctx.add_dependency(name='test-dependency', recurse=False)

    def libfoo_resolve(ctx, path):
        """ Mocking the resolve function which is the one called when
        fetching a dependency"""
        p = os.path.join(path, 'libfoo')

        return p

    foo_resolver = mock.Mock()
    foo_resolver.resolve.side_effect = libfoo_resolve
    foo_resolver.hash.return_value = 'h4sh'

    ctx.add_dependency(name='libfoo', resolver=foo_resolver, optional=False, recurse=True)

    assert(0)

def options(opt):
    pass

def configure(conf):
    pass


def build(bld):
    pass
