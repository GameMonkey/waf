#! /usr/bin/env python
# encoding: utf-8

import os

APPNAME = 'test_http_dependency'
VERSION = '1.0.0'

def resolve(ctx):

    ctx.add_dependency(
        name='cxx-prettyprint',
        internal=False,
        optional=False,
        resolver='http',
        extract=True,
        filename='prettyprint.zip',
        sources=['https://github.com/louisdx/cxx-prettyprint/zipball/master'])

def options(opt):
    opt.load('compiler_cxx')

def configure(conf):
    conf.load('compiler_cxx')

def build(bld):

    # cxx-prettyprint is a header-only library so we just need to
    # export its include. The zip archive cotains one folder so we
    # need to use that one.

    cxx_prettyprint_dirs = os.listdir(bld.dependency_path('cxx-prettyprint'))

    if len(cxx_prettyprint_dirs) != 1:
        # There should be only one directory
        bld.fatal('There should be only one contained dir in the zip {}'.format(
            cxx_prettyprint_dirs))

    cxx_prettyprint_path = os.path.join(bld.dependency_path('cxx-prettyprint'),
        cxx_prettyprint_dirs[0])

    bld(export_includes=cxx_prettyprint_path, name='cxx_prettyprint')

    bld.program(features='cxx',
                source='main.cpp',
                target='app',
                use=['cxx_prettyprint'])
